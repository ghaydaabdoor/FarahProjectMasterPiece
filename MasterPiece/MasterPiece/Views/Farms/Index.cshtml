@model IEnumerable<MasterPiece.Models.Farm>

@{
    ViewBag.Title = "المزارع";
    Layout = "~/Views/Shared/_LayoutUser.cshtml";
}
<style>
    .cart {
        transform: translateY(-45px);
    }

    .btn-getstarted {
        padding: 5px 10px;
        border-radius: 0px;
        border: 2px solid var(--accent-color);
        background: var(--accent-color);
        text-align: center;
        width: 30%;
        font-size: 14px;
        height: 35px;
    }

    #det {
        color: #34495E;
        background-color: white;
        border: 1px solid #34495E;
    }
</style>
<main class="main">

    <!-- EachService Section -->
    <section id="EachService" class="EachService section">

        <!-- Section Title -->
        <div class="container" data-aos="fade-up">
            <p class="Eachsection-title">مزارع خاصة للحفلات والمناسبات الخاصة في اربد<br></p>
            <p class="Eachsection-description">استمتع بجولة مميزة في أفضل المزارع في إربد، حيث تجد مجموعة متنوعة من الأماكن الطبيعية الرائعة لإقامة أحداثك الخاصة. إليك قائمة ببعض المزارع المميزة في المنطقة</p>
        </div>>
        <!-- End Section Title -->

        <div class="container">

            <div class="row gy-4">


                @foreach (var item in Model)
                {
                    <div class="col-lg-4 col-md-6" data-aos="fade-up" data-aos-delay="100">
                        <div class="card">
                            <div class="card-img">
                                <img src="~/Content/img/@item.ImageUrl" alt="" class="img-fluid">
                            </div>
                            <h3>@item.Name</h3>
                            <p>@item.Location</p>
                            <p>السعر: @item.Price دينار</p>
                            <div class="stars">
                                <a class="btn-getstarted details-btn" id="det" href="@Url.Action("Index", "FarmDetails", new {id=item.FarmId})">التفاصيل</a>
                                <a class="btn-getstarted details-btn cart" href="javascript:void(0);" onclick="checkBooking(@item.FarmId)">احجز الآن</a>
                                <span>@item.Rate (20)</span>
                                <div><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i></div>
                            </div>
                        </div>
                    </div>
                    <!-- End Card Item -->
                }

            </div>


        </div>

    </section>
    <!-- /EachService Section -->

</main>

<script>
    function checkBooking(farmId) {
        $.ajax({
            url: '@Url.Action("CreateFarmForm", "Bookings")',
            type: 'GET',
            data: { id: farmId },
            success: function (response) {
                if (response.loginRequired) {
                    // Show SweetAlert for login prompt
                    Swal.fire({
                        title: 'يجب تسجيل الدخول',
                        text: 'يجب تسجيل الدخول لمتابعة عملية الحجز',
                        icon: 'warning',
                        showCancelButton: true,
                        confirmButtonColor: '#3085d6',
                        cancelButtonColor: '#d33',
                        confirmButtonText: 'تسجيل الدخول',
                        cancelButtonText: 'إلغاء',
                        reverseButtons: true,
                    }).then((result) => {
                        if (result.isConfirmed) {
                            // Redirect to login page with a returnUrl to continue booking after login
                            var returnUrl = '@Url.Action("CreateFarmFormView", "Bookings", new { id = "__id__" })'.replace('__id__', farmId);
                            window.location.href = '@Url.Action("Login", "Users")' + '?returnUrl=' + encodeURIComponent(returnUrl);
                        }
                    });
                } else if (response.redirect) {
                    // If user is logged in, redirect to venue form
                    window.location.href = response.redirect;
                } else {
                    // Generic error handling
                    Swal.fire({
                        title: 'خطأ',
                        text: 'حدث خطأ أثناء معالجة طلبك.',
                        icon: 'error',
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'حسناً'
                    });
                }
            },
            error: function () {
                // Handle AJAX errors with a SweetAlert error message
                Swal.fire({
                    title: 'خطأ',
                    text: 'حدث خطأ أثناء معالجة طلبك.',
                    icon: 'error',
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: 'حسناً'
                });
            }
        });
    }
</script>